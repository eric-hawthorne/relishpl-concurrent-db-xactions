<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>
relish programming language
</title>

<meta name="keywords" content="relish programming language web application development framework persistence" />
 <meta name="description" content="Home page for relish(TM), an application programming language which includes a simple full-stack web application framework and transparent persistence. Focus is on simplicity and minimalism via very strict enforcement of conventions. The name comes from the language's inbuilt construct of relations between datatypes. A programmer can express an entity-relation model of the application domain directly in the language then associate instances. Methods are owned by tuples of datatypes, and are dispatched by multi-argument multimethod dispatch.
relish is implemented in Go, and inherits/wraps some Go features like goroutine concurrency and channels, but is almost entirely unlike Go in language constructs and philosophy." />
 

 <link rel="stylesheet" type="text/css" id="stylesheet"
       href="/styles/default.css" />
 <link rel="stylesheet" type="text/css" id="stylesheet"
       href="/styles/playground.css" />

<!-- Uncomment only one of the following 3 lines. -->
<script type="text/javascript" src="jquery-2.0.3.js"></script> <!-- jquery for testing - 230kB -->
<!-- <script type="text/javascript" src="jquery-2.0.3.min.js"></script> --> <!-- minified jquery for production - 81kB -->
<!-- <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script> --> <!-- jquery loaded from a CDN -->

	<script type="text/javascript">
		
		function help(topic) {
			mywindow = window.open ("/help/" + topic + ".html");
			mywindow.moveTo(150,50);	
			return false;		
		}

		function loadProgram() {
			var sel = document.getElementById("chosenArtfctName");
			var chosenArtfct = sel.options[sel.selectedIndex].value;
			if (chosenArtfct != "-- Choose existing trial program --") {
               location.href = "/?artfct=" + chosenArtfct 
            }
		}

    var programURL = "";  // Web services root url we are currently connected to. Excludes trailing /

    /*
    Makes a web service request to the explorer_api of the target program, which is assumed to be
    listening for and responding to http requests to the explore_api.
    Requests the list of (non-primitive) data types in the target program.
    Populates the type select options.
    */
    function connectToProgram() {
      programURL = document.getElementById("programUrl").value
      programURL = programURL.trim()
      if (programURL.lastIndexOf("/") == programURL.length - 1) {
         programURL = programURL.substring(0,programURL.length - 1)
      }
      if (programURL == "") {
         alert("Please supply the web service URL of the target program that is to be debugged.");
         return
      }
      if (programURL.indexOf("http://") == -1 && programURL.indexOf("https://") == -1) {
         programURL = "http://" + programURL
      }
      $.ajax({
        type: "POST",
        url: "/types",
        dataType: "json",         
        data: {"url" : programURL}
      }).done( function(msg) {
           $("select#type").html("")
           var options = ""
           for (i = 0; i < msg.length; i++) {
               options += "<option>" + msg[i] + "</option>\n";
           }
          $("select#type").append(options)              
        // alert( "Data Received: " + msg );
      }).fail( function( xmlHttpRequest, statusText, errorThrown ) {
        alert(
          "Your form submission failed.\n\n"
            + "XML Http Request: " + JSON.stringify( xmlHttpRequest )
            + ",\nStatus Text: " + statusText
            + ",\nError Thrown: " + errorThrown );
      });
    }

    function findNamedObjects() {
      if (programURL == "") {
         alert("Please supply the web service URL of the target program that is to be debugged.");
         return         
      }    

      var prefix = document.getElementById("prefix").value

      $.ajax({
        type: "POST",
        url: "/names",
        dataType: "json",         
        data: {"url" : programURL, "prefix" : prefix}
      }).done( function(msg) {
           $("div#objectList").html("")
           var options = ""
           for (i = 0; i < msg.length; i++) {
               options += "<div class='objectListEntry' onclick='focusOnObject(this)'>" + msg[i] + "</div>\n";
           }
          $("div#objectList").append(options)	
          // alert( "Data Received: " + msg );
      }).fail( function( xmlHttpRequest, statusText, errorThrown ) {
        alert(
          "Your form submission failed.\n\n"
            + "XML Http Request: " + JSON.stringify( xmlHttpRequest )
            + ",\nStatus Text: " + statusText
            + ",\nError Thrown: " + errorThrown );
      });
    }

    function selectObjectsOfType() {
      if (programURL == "") {
         alert("Please supply the web service URL of the target program that is to be debugged.")
         return         
      }      
  
      var typeSelect = document.getElementById("type")
      if (typeSelect.selectedIndex == -1) {
          alert("The target program does not appear to define or use\nany structured-object or collection datatypes.\nNothing to explore.");
         return       
      }
      var objType = typeSelect.options[typeSelect.selectedIndex].value
      var whereClause = document.getElementById("where").value
      if (objType == "") {
         alert("The target program does not appear to define or use\nany structured-object or collection datatypes.\nNothing to explore.");
         return
      }
      $.ajax({
        type: "POST",
        url: "/list",
        dataType: "json",        
        data: {"url" : programURL, "type": objType, "where" : whereClause}
      }).done( function(msg) {
           $("div#objectList").html("")
           var options = ""
           for (i = 0; i < msg.length; i++) {
               options += "<div class='objectListEntry' onclick='focusOnObject(this)'>" + msg[i] + "</div>\n";
           }
          $("div#objectList").append(options)
          // alert( "Data Received: " + msg );	
      }).fail( function( xmlHttpRequest, statusText, errorThrown ) {
        alert(
          "Your form submission failed.\n\n"
            + "XML Http Request: " + JSON.stringify( xmlHttpRequest )
            + ",\nStatus Text: " + statusText
            + ",\nError Thrown: " + errorThrown );
      });   

    }    

    /*
    Populate the dataPane with an object network centred on (focussed on) the selected object.
    */
    function focusOnObject(theDiv) {
      var selectedObjectToken = $( theDiv ).text();
      // alert(selectedObjectToken);
      $.ajax({
        type: "POST",
        url: "/objectTree",
        dataType: "json",        
        data: {"url" : programURL, "objectToken": selectedObjectToken, "depth": 3}
      }).done( function(tree) {
         $("div#dataPane").html("");
         if ("service error" in tree) {
            $("div#dataPane").append("<h3>service error</h3>");   
            $("div#dataPane").append("<p>" + tree["service error"] + "</p>");                       
         } else {
            var visitedObjects = {};          
            var treeHtml = displayTree(tree.objects, tree.rootReflectId, tree.depth, visitedObjects);
            $("div#dataPane").append(treeHtml);               
         }

         //$("div#dataPane").text(msg)
         //alert( "Data Received: " + msg );  
      }).fail( function( xmlHttpRequest, statusText, errorThrown ) {
        alert(
          "Your form submission failed.\n\n"
            + "XML Http Request: " + JSON.stringify( xmlHttpRequest )
            + ",\nStatus Text: " + statusText
            + ",\nError Thrown: " + errorThrown );
      }); 
      
      return false;
    }


    function displayTree(objects,reflectId,depth,visitedObjects) {
       if (depth < 0) {
           return ""
       }

       var htmlText = "<div class='objNode" + depth + "'>";       

       var obj = objects[reflectId];  

       htmlText += objectTokenHtml(obj);         
       
       if (depth < 1) {

          htmlText += "</div>";           
          return htmlText
       }

       // TODO - display simple attributes

       htmlText += "<table class='simpleAttrs'>";  
       var simpleAttributes = obj.simpleAttrs;

       for (var i = 0; i < simpleAttributes.length; i++) {
          var sAttr = simpleAttributes[i];
          var attrVal = sAttr.val;
          htmlText += "<tr><td class='simpleAttrName'><b>" + sAttr.attrName + ":</b></td><td>" + primitiveValHtml(sAttr.typeName, sAttr.val) + "</td></tr>";                              
       }
       htmlText += "</table>";   

       if (depth < 2) {

          htmlText += "</div>";           
          return htmlText
       }

       if ( ! ( reflectId in visitedObjects ) ) {

           visitedObjects[reflectId] = obj

           // display complex attributes
           var complexAttributes = obj.complexAttrs;
           for (var i = 0; i < complexAttributes.length; i++) {
              htmlText += "<div class='complexAttr'>";    

              var cAttr = complexAttributes[i];
              var nAttrVals = cAttr.vals.length;
              htmlText += "<h4>" + attrNameAndPropertiesHtml(cAttr)+ "</h4>";          
              for (var j = 0; j < nAttrVals; j++ ) {
                if (nAttrVals > 1) {
                    htmlText += j + ": ";                   
                }
                var val = cAttr.vals[j];
                if (cAttr.valIsObject) {
                  htmlText += "<br/>";                     
                  htmlText += displayTree(objects,val,depth-1,visitedObjects);
                  htmlText += "<br/>";   
                } else {
                    htmlText += primitiveValHtml(cAttr.typeName, val);
                    htmlText += "<br/>";                    
                }
              }
              htmlText += "</div>"; 
           }
       }

       htmlText += "</div>";

       return htmlText   
    }

    function objectTokenHtml(obj) {
       return "<h3 title='" + obj.typeName + "'>" + shortTypeName(obj.typeName) + ":#" + obj.reflectId + "</h3>"
    }

    function shortTypeName(typeName) {
       commaPos = typeName.indexOf(",")
       if (commaPos > 0) {
          return typeName.substring(0,commaPos);
       }
    }


    function attrNameAndPropertiesHtml(complexAttr) {
       var maxArity = "N"
       if (complexAttr.maxArity != -1) {
          maxArity = "" + complexAttr.maxArity
       }
       var minArity = ""
       if (complexAttr.minArity != 1) {
           minArity = complexAttr.minArity + " "
       }
       return "--&gt;" +complexAttr.attrName + " " +  minArity + maxArity + " --&gt;";
    }

    function primitiveValHtml(typeName,val) {
      switch(typeName) {
        case "String":      
           return "\"" + val + "\"";
        default:
           return val;
      }
    }


/*
$.ajax({
  type: "POST",
  url: "example.php",
  data: "name=John&location=Boston"
}).done( function(msg) {
  alert( "Data Saved: " + msg );
}).fail( function( xmlHttpRequest, statusText, errorThrown ) {
  alert(
    "Your form submission failed.\n\n"
      + "XML Http Request: " + JSON.stringify( xmlHttpRequest )
      + ",\nStatus Text: " + statusText
      + ",\nError Thrown: " + errorThrown );
});
*/






        
	</script>
</head>
<body>
	
  <div id="header">	
  <table>
	<tr>
	  <td>	
        <a href="/"><img src="/relish_logo4_small.png"></a>
      </td>
	  <td>	
         &nbsp; &nbsp;
      </td>
	  <td>	
        <h1><a href="/">relish<span class="trademark">&#8482;</span></a></h1>
      </td>
	  <td style="width: 2em">	
         &nbsp; &nbsp;
      </td>

     
	  <td>
	    <table>
	      <tr>
	        <td>	
              <h2>data explorer</h2>
            </td>
            <td style="width: 1em">	
               &nbsp; &nbsp;
            </td>
            <td>
            	<table>
            		<tr>
            			<td>
                           <h3>Target Program URL &nbsp; <input type="button" class="helpbutton" value="?" onclick="javascript:help('target_program_url')"/> :</h3>            				
            			</td>
            			<td colspan="2">
                           <input type="text" size="40" id="programUrl" value="{{.programUrl}}" />	            			
            			</td>      
                        <td>
                           <input type="button" value="connect to program" onclick="connectToProgram()" />
                        </td>           			        			
            		</tr>
            		<tr>
            		    <td style="text-align: right;">
               	           <h3>Object Name starts with :</h3>            		    	
            			</td>  
            			<td>
            			   <input type="text" size="30" id="prefix" value="{{.prefix}}" />	
            			</td> 
                        <td>
                           <input type="button" value="find named objects" onclick="findNamedObjects()" />
	                    </td>          			
            		</tr>            		
            		<tr>
            		    <td style="text-align: right;">
               	           <h3>Data Type :</h3>            		    	
            			</td>  
                        <td>
                  	     <select id="type">
                  		 {{range .types}}
                  	 	 <option>{{.}}</option>
                  	 	 {{end}}
                        </select>		
                        </td>
            			<td>
            			   Where: <input type="text" size="60" id="where" value="{{.where}}" />	
            			</td>      
                        <td>
                          <input type="button" value="find" onclick="selectObjectsOfType()" />
                        </td>     			
            		</tr>     		            		
            	</table>
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
	 
  </div>
  <!-- <div id="download_button" class="menubutton" onclick="location='/download/'">
	DOWNLOAD
  </div> -->

<div id="content">
	<div id="dataPane">
	</div>
	<div id="objectList">		
	</div>
</div>
</body>
</html>